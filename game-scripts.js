pc.script.createLoadingScreen(function(e){var t,a;t=["body {","    background-color: #000;","}","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #000;","}","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","#application-splash img {","    width: 100%;","}","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #fff;","}","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #e63946;","}","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://raw.githubusercontent.com/paragvaev/sslab/master/bl.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",function(){e.off("preload:progress")}),e.on("preload:progress",function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")}),e.on("start",function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)})});var Responsive=pc.createScript("responsive");Responsive.prototype.initialize=function(){this.app.root.findByName("Camera").camera.horizontalFov=!0},Responsive.prototype.update=function(e){};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.prototype.initialize=function(){var e=this.app.root.findByName("Camera");this.cameraScript=e.script.cameraMovement},PlayerMovement.prototype.update=function(e){var t=this.app,r=this.entity.forward,i=this.entity.right,a=0,s=0;if(t.keyboard.isPressed(pc.KEY_A)&&(a-=i.x,s-=i.z),t.keyboard.isPressed(pc.KEY_D)&&(a+=i.x,s+=i.z),t.keyboard.isPressed(pc.KEY_W)&&(a+=r.x,s+=r.z),t.keyboard.isPressed(pc.KEY_S)&&(a-=r.x,s-=r.z),0!==a||0!==s){var p=new pc.Vec3(a*e,0,s*e);p.normalize().scale(this.speed),p.add(this.entity.getPosition());var o=this.cameraScript.eulers.x+180,n=new pc.Vec3(0,o,0);this.entity.rigidbody.teleport(p,n)}};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var e=this.app;e.mouse.on("mousemove",this.onMouseMove,this),e.mouse.on("mousedown",function(){e.mouse.disablePointerLock()},this),this.rayEnd=e.root.findByName("RaycastEndPoint")},CameraMovement.prototype.postUpdate=function(e){var t=this.entity.parent,o=this.eulers.x,s=this.eulers.y,i=new pc.Vec3(-s,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){this.eulers.x-=this.mouseSpeed*e.dx/100%360,this.eulers.y+=this.mouseSpeed*e.dy/360%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360)},CameraMovement.prototype.getWorldPoint=function(){var e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t};pc.extend(pc,function(){var e=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(t,s,r,o,i){t[0]=computeGaussian(0,i),s[0]=0,s[1]=0;var a,l,u=t[0];for(a=0,l=Math.floor(e/2);a<l;a++){var h=computeGaussian(a+1,i);t[2*a]=h,t[2*a+1]=h,u+=2*h;var n=2*a+1.5;s[4*a]=r*n,s[4*a+1]=o*n,s[4*a+2]=-r*n,s[4*a+3]=-o*n}for(a=0,l=t.length;a<l;a++)t[a]/=u}var t=function(t){var s={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),o=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),i=["precision "+t.precision+" float;","","#define SAMPLE_COUNT "+e,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),a=["precision "+t.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:o}),this.blurShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:i}),this.combineShader=new pc.Shader(t,{attributes:s,vshader:r,fshader:a});var l=t.width,u=t.height;this.targets=[];for(var h=0;h<2;h++){var n=new pc.Texture(t,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:l>>1,height:u>>1});n.minFilter=pc.FILTER_LINEAR,n.magFilter=pc.FILTER_LINEAR,n.addressU=pc.ADDRESS_CLAMP_TO_EDGE,n.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var f=new pc.RenderTarget(t,n,{depth:!1});this.targets.push(f)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(e),this.sampleOffsets=new Float32Array(2*e)};return(t=pc.inherits(t,pc.PostEffect)).prototype=pc.extend(t.prototype,{render:function(e,t,s){var r=this.device,o=r.scope;o.resolve("uBloomThreshold").setValue(this.bloomThreshold),o.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(r,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),o.resolve("uBlurWeights[0]").setValue(this.sampleWeights),o.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),o.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(r,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),o.resolve("uBlurWeights[0]").setValue(this.sampleWeights),o.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),o.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(r,this.targets[0],this.vertexBuffer,this.blurShader),o.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),o.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),o.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(r,t,this.vertexBuffer,this.combineShader,s)}}),{BloomEffect:t}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",function(e,t){this.effect[e]=t},this),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var ReportSystem=pc.createScript("reportsystem");ReportSystem.attributes.add("entity",{type:"entity"}),ReportSystem.prototype.initialize=function(){var t=this.entity.findByName("rsBTN");t.element.on("mouseup",this.onClick,this),t.element.on("touchstart",this.onTouchStart,this)},ReportSystem.prototype.onClick=function(){window.open("https://apollonia.today/ubi")};var Terrain=pc.createScript("terrain");Terrain.attributes.add("heightMap",{type:"asset",assetType:"texture"}),Terrain.attributes.add("minHeight",{type:"number",default:0}),Terrain.attributes.add("maxHeight",{type:"number",default:10}),Terrain.attributes.add("width",{type:"number",default:100}),Terrain.attributes.add("depth",{type:"number",default:100}),Terrain.attributes.add("subdivisions",{type:"number",default:250}),Terrain.attributes.add("material",{type:"asset",assetType:"material"}),Terrain.prototype.initialize=function(){var i=this.heightMap.resource.getSource(),e=this.createTerrainFromHeightMap(i,this.subdivisions),t=this.createTerrainFromHeightMap(i,this.subdivisions/2);this.entity.addComponent("model"),this.entity.model.model=e,this.entity.addComponent("collision",{type:"mesh"}),this.entity.collision.model=t,this.entity.addComponent("rigidbody",{friction:.5,type:"static"})},Terrain.prototype.createTerrainVertexData=function(i){var e,t,s=[],r=[],a=[];for(e=0;e<=i.subdivisions;e++)for(t=0;t<=i.subdivisions;t++){var n=new pc.Vec3(t*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-e)*i.height/i.subdivisions-i.height/2),h=4*(((n.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(n.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth),d=.3*(i.buffer[h]/255)+.59*(i.buffer[h+1]/255)+.11*(i.buffer[h+2]/255);n.y=i.minHeight+(i.maxHeight-i.minHeight)*d,s.push(n.x,n.y,n.z),r.push(t/i.subdivisions,1-e/i.subdivisions)}for(e=0;e<i.subdivisions;e++)for(t=0;t<i.subdivisions;t++)a.push(t+e*(i.subdivisions+1)),a.push(t+1+e*(i.subdivisions+1)),a.push(t+1+(e+1)*(i.subdivisions+1)),a.push(t+e*(i.subdivisions+1)),a.push(t+1+(e+1)*(i.subdivisions+1)),a.push(t+(e+1)*(i.subdivisions+1));return{indices:a,positions:s,normals:pc.calculateNormals(s,a),uvs:r}},Terrain.prototype.createTerrainFromHeightMap=function(i,e){var t=document.createElement("canvas"),s=t.getContext("2d"),r=i.width,a=i.height;t.width=r,t.height=a,s.drawImage(i,0,0);var n=s.getImageData(0,0,r,a).data,h=this.createTerrainVertexData({width:this.width,height:this.depth,subdivisions:e,minHeight:this.minHeight,maxHeight:this.maxHeight,buffer:n,bufferWidth:r,bufferHeight:a}),d=new pc.GraphNode,u=this.material.resource,o=pc.createMesh(this.app.graphicsDevice,h.positions,{normals:h.normals,uvs:h.uvs,indices:h.indices}),p=new pc.MeshInstance(d,o,u),b=new pc.Model;return b.graph=d,b.meshInstances.push(p),b};pc.extend(pc,function(){var e=function(e){var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:s}),this.offset=1,this.darkness=1};return(e=pc.inherits(e,pc.PostEffect)).prototype=pc.extend(e,{render:function(e,t,i){var s=this.device,f=s.scope;f.resolve("uColorBuffer").setValue(e.colorBuffer),f.resolve("uOffset").setValue(this.offset),f.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.vignetteShader,i)}}),{VignetteEffect:e}}());var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,precision:5,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,precision:5,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new pc.VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",function(e,t){this.effect[e]=t},this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)})};var Rotate=pc.createScript("rotate");Rotate.prototype.update=function(t){this.entity.rotate(10,10*t,0)};var Ui=pc.createScript("ui");Ui.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Ui.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Ui.prototype.initialize=function(){var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.counter=0,this.bindEvents()},Ui.prototype.bindEvents=function(){var t=this,e=this.div.querySelector(".button"),i=this.div.querySelector(".counter");e&&e.addEventListener("click",function(){++t.counter,i&&(i.textContent=t.counter),console.log("button clicked");var e=pc.app.root.findByName("chamferbox");if(e&&e.model&&e.model.model){var s=e.model.model.meshInstances[0].material;s&&(s.diffuse.set(Math.random(),Math.random(),Math.random()),s.update())}},!1),i&&(i.textContent=t.counter)};var CharacterController=pc.createScript("characterController");CharacterController.attributes.add("speed",{type:"number",default:5}),CharacterController.attributes.add("jumpImpulse",{type:"number",default:400}),CharacterController.prototype.initialize=function(){this.groundCheckRay=new pc.Vec3(0,-1.2,0),this.rayEnd=new pc.Vec3,this.groundNormal=new pc.Vec3,this.onGround=!0,this.jumping=!1},CharacterController.prototype.move=function(t){if(this.onGround&&!this.jumping){var r=new pc.Vec3,e=t.length();e>0&&(r.cross(this.groundNormal,t).cross(r,this.groundNormal),r.normalize().scale(e*this.speed)),this.entity.rigidbody.linearVelocity=r}},CharacterController.prototype.jump=function(){this.onGround&&!this.jumping&&(this.entity.rigidbody.applyImpulse(0,this.jumpImpulse,0),this.onGround=!1,this.jumping=!0,setTimeout(function(){this.jumping=!1}.bind(this),500))},CharacterController.prototype.update=function(t){var r=this.entity.getPosition();this.rayEnd.add2(r,this.groundCheckRay);var e=this.app.systems.rigidbody.raycastFirst(r,this.rayEnd);this.onGround=!!e,e&&this.groundNormal.copy(e.normal)};var VirtualJoystick=pc.createScript("virtualJoystick");VirtualJoystick.attributes.add("stick",{type:"entity"}),VirtualJoystick.attributes.add("enableEvent",{type:"string"}),VirtualJoystick.attributes.add("moveEvent",{type:"string"}),VirtualJoystick.attributes.add("disableEvent",{type:"string"}),VirtualJoystick.prototype.initialize=function(){var t=this.app;t.on(this.enableEvent,function(t,i){this.entity.setLocalPosition(t,-i,0),this.stick.setLocalPosition(t,-i,0),this.entity.element.enabled=!0,this.stick.element.enabled=!0},this),t.on(this.moveEvent,function(t,i){this.stick.setLocalPosition(t,-i,0)},this),t.on(this.disableEvent,function(){this.entity.element.enabled=!1,this.stick.element.enabled=!1},this)};var FirstPersonView=pc.createScript("firstPersonView");FirstPersonView.attributes.add("camera",{title:"Camera",description:"The camera controlled by this first person view. It should be a child of the entity to which this script is assigned. If no camera is assigned, the script will create one for you.",type:"entity"}),FirstPersonView.prototype.initialize=function(){var e=this.app;this.camera||(this.camera=this.entity.findByName("Camera"),this.camera||(this.camera=new pc.Entity("FPS Camera"),this.camera.addComponent("camera"))),this.x=new pc.Vec3,this.z=new pc.Vec3,this.heading=new pc.Vec3,this.magnitude=new pc.Vec2,this.azimuth=0,this.elevation=0;var t=this.camera.forward.clone();t.y=0,t.normalize(),this.azimuth=Math.atan2(-t.x,-t.z)*(180/Math.PI),(new pc.Mat4).setFromAxisAngle(pc.Vec3.UP,-this.azimuth).transformVector(this.camera.forward,t),this.elevation=Math.atan(t.y,t.z)*(180/Math.PI),this.forward=0,this.strafe=0,this.jump=!1,this.cnt=0,e.on("firstperson:forward",function(e){this.forward=e},this),e.on("firstperson:strafe",function(e){this.strafe=e},this),e.on("firstperson:look",function(e,t){this.azimuth+=e,this.elevation+=t,this.elevation=pc.math.clamp(this.elevation,-90,90)},this),e.on("firstperson:jump",function(){this.jump=!0},this)},FirstPersonView.prototype.postUpdate=function(e){this.camera.setEulerAngles(this.elevation,this.azimuth,0),this.z.copy(this.camera.forward),this.z.y=0,this.z.normalize(),this.x.copy(this.camera.right),this.x.y=0,this.x.normalize(),this.heading.set(0,0,0),0!==this.forward&&(this.z.scale(this.forward),this.heading.add(this.z)),0!==this.strafe&&(this.x.scale(this.strafe),this.heading.add(this.x)),this.heading.length()>1e-4&&(this.magnitude.set(this.forward,this.strafe),this.heading.normalize().scale(this.magnitude.length())),this.jump&&(this.entity.script.characterController.jump(),this.jump=!1),this.entity.script.characterController.move(this.heading);var t=this.camera.getPosition();this.app.fire("cameramove",t)};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){var e=this.app,t=function(t,i){switch(t){case 38:case 87:e.fire("firstperson:forward",i);break;case 40:case 83:e.fire("firstperson:forward",-i);break;case 37:case 65:e.fire("firstperson:strafe",-i);break;case 39:case 68:e.fire("firstperson:strafe",i)}},i=function(i){i.repeat||(t(i.keyCode,1),32===i.keyCode&&e.fire("firstperson:jump"))},s=function(e){t(e.keyCode,0)},a=function(){window.addEventListener("keydown",i,!0),window.addEventListener("keyup",s,!0)};this.on("enable",a),this.on("disable",function(){window.addEventListener("keydown",i,!0),window.addEventListener("keyup",s,!0)}),a()};var MouseInput=pc.createScript("mouseInput");function applyRadialDeadZone(e,t,i,s){var a=e.length();if(a>i){var n=1-s-i,r=Math.min(1,(a-i)/n)/a;t.copy(e).scale(r)}else t.set(0,0)}MouseInput.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice.canvas,i=function(e){document.pointerLockElement!==t&&t.disablePointerLock&&t.disablePointerLock()},s=function(i){if(document.pointerLockElement===t){var s=event.movementX||event.webkitMovementX||event.mozMovementX||0,a=event.movementY||event.webkitMovementY||event.mozMovementY||0;e.fire("firstperson:look",-s/5,-a/5)}},a=function(){window.addEventListener("mousedown",i,!1),window.addEventListener("mousemove",s,!1)};this.on("enable",a),this.on("disable",function(){window.removeEventListener("mousedown",i,!1),window.removeEventListener("mousemove",s,!1)}),a()};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("deadZone",{title:"Dead Zone",description:"Radial thickness of inner dead zone of the virtual joysticks. This dead zone ensures the virtual joysticks report a value of 0 even if a touch deviates a small amount from the initial touch.",type:"number",min:0,max:.4,default:.3}),TouchInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:50}),TouchInput.attributes.add("radius",{title:"Radius",description:"The radius of the virtual joystick in CSS pixels.",type:"number",default:50}),TouchInput.attributes.add("doubleTapInterval",{title:"Double Tap Interval",description:"The time in milliseconds between two taps of the right virtual joystick for a double tap to register. A double tap will trigger a jump.",type:"number",default:300}),TouchInput.prototype.initialize=function(){var e=this.app,t=e.graphicsDevice,i=t.canvas;this.remappedPos=new pc.Vec2,this.leftStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={identifier:-1,center:new pc.Vec2,pos:new pc.Vec2},this.lastRightTap=0;var s=function(s){s.preventDefault();for(var a=t.width/i.clientWidth,n=t.height/i.clientHeight,r=s.changedTouches,o=0;o<r.length;o++){var h=r[o];if(h.pageX<=i.clientWidth/2&&-1===this.leftStick.identifier)this.leftStick.identifier=h.identifier,this.leftStick.center.set(h.pageX,h.pageY),this.leftStick.pos.set(0,0),e.fire("leftjoystick:enable",h.pageX*a,h.pageY*n);else if(h.pageX>i.clientWidth/2&&-1===this.rightStick.identifier){this.rightStick.identifier=h.identifier,this.rightStick.center.set(h.pageX,h.pageY),this.rightStick.pos.set(0,0),e.fire("rightjoystick:enable",h.pageX*a,h.pageY*n);var d=Date.now();d-this.lastRightTap<this.doubleTapInterval&&e.fire("firstperson:jump"),this.lastRightTap=d}}}.bind(this),a=function(s){s.preventDefault();for(var a=t.width/i.clientWidth,n=t.height/i.clientHeight,r=s.changedTouches,o=0;o<r.length;o++){var h=r[o];h.identifier===this.leftStick.identifier?(this.leftStick.pos.set(h.pageX,h.pageY),this.leftStick.pos.sub(this.leftStick.center),this.leftStick.pos.scale(1/this.radius),e.fire("leftjoystick:move",h.pageX*a,h.pageY*n)):h.identifier===this.rightStick.identifier&&(this.rightStick.pos.set(h.pageX,h.pageY),this.rightStick.pos.sub(this.rightStick.center),this.rightStick.pos.scale(1/this.radius),e.fire("rightjoystick:move",h.pageX*a,h.pageY*n))}}.bind(this),n=function(t){t.preventDefault();for(var i=t.changedTouches,s=0;s<i.length;s++){var a=i[s];a.identifier===this.leftStick.identifier?(this.leftStick.identifier=-1,e.fire("firstperson:forward",0),e.fire("firstperson:strafe",0),e.fire("leftjoystick:disable")):a.identifier===this.rightStick.identifier&&(this.rightStick.identifier=-1,e.fire("rightjoystick:disable"))}}.bind(this),r=function(){i.addEventListener("touchstart",s,!1),i.addEventListener("touchmove",a,!1),i.addEventListener("touchend",n,!1)};this.on("enable",r),this.on("disable",function(){i.removeEventListener("touchstart",s,!1),i.removeEventListener("touchmove",a,!1),i.removeEventListener("touchend",n,!1)}),r()},TouchInput.prototype.update=function(e){var t=this.app;if(-1!==this.leftStick.identifier){applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZone,0);var i=this.remappedPos.x;this.lastStrafe!==i&&(t.fire("firstperson:strafe",i),this.lastStrafe=i);var s=-this.remappedPos.y;this.lastForward!==s&&(t.fire("firstperson:forward",s),this.lastForward=s)}if(-1!==this.rightStick.identifier){applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZone,0);var a=-this.remappedPos.x*this.turnSpeed*e,n=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",a,n)}};var GamePadInput=pc.createScript("gamePadInput");GamePadInput.attributes.add("deadZoneLow",{title:"Low Dead Zone",description:"Radial thickness of inner dead zone of pad's joysticks. This dead zone ensures that all pads report a value of 0 for each joystick axis when untouched.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("deadZoneHigh",{title:"High Dead Zone",description:"Radial thickness of outer dead zone of pad's joysticks. This dead zone ensures that all pads can reach the -1 and 1 limits of each joystick axis.",type:"number",min:0,max:.4,default:.1}),GamePadInput.attributes.add("turnSpeed",{title:"Turn Speed",description:"Maximum turn speed in degrees per second",type:"number",default:90}),GamePadInput.prototype.initialize=function(){this.app;this.lastStrafe=0,this.lastForward=0,this.lastJump=!1,this.remappedPos=new pc.Vec2,this.leftStick={center:new pc.Vec2,pos:new pc.Vec2},this.rightStick={center:new pc.Vec2,pos:new pc.Vec2};var e=function(){window.addEventListener("gamepadconnected",function(e){}),window.addEventListener("gamepaddisconnected",function(e){})};this.on("enable",e),this.on("disable",function(){window.removeEventListener("gamepadconnected",function(e){}),window.removeEventListener("gamepaddisconnected",function(e){})}),e()},GamePadInput.prototype.update=function(e){for(var t=this.app,i=navigator.getGamepads?navigator.getGamepads():[],s=0;s<i.length;s++){var a=i[s];if(a&&"standard"===a.mapping&&a.axes.length>=4){this.leftStick.pos.set(a.axes[0],a.axes[1]),applyRadialDeadZone(this.leftStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var n=this.remappedPos.x;this.lastStrafe!==n&&(t.fire("firstperson:strafe",n),this.lastStrafe=n);var r=-this.remappedPos.y;this.lastForward!==r&&(t.fire("firstperson:forward",r),this.lastForward=r),this.rightStick.pos.set(a.axes[2],a.axes[3]),applyRadialDeadZone(this.rightStick.pos,this.remappedPos,this.deadZoneLow,this.deadZoneHigh);var o=-this.remappedPos.x*this.turnSpeed*e,h=-this.remappedPos.y*this.turnSpeed*e;t.fire("firstperson:look",o,h),a.buttons[0].pressed&&!this.lastJump&&t.fire("firstperson:jump"),this.lastJump=a.buttons[0].pressed}}};